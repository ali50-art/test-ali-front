(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[288],{683:function(e,t,a){Promise.resolve().then(a.bind(a,7211))},7907:function(e,t,a){"use strict";var r=a(5313);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},7211:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var r=a(7437),o=a(2265),n=a(7907),s=a(2926);function u(e){let{children:t}=e,a=(0,n.useRouter)(),u=(0,n.usePathname)(),{isAuthenticated:c,isLoading:l}=(0,s.useAuth)(),i=(0,o.useRef)(null);return(0,o.useEffect)(()=>{!l&&c&&"/login"===u&&a.replace("/dashboard"),console.log("public layout...",c,l)},[c,l,a,u]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"drawer",children:[(0,r.jsx)("input",{id:"left-sidebar-drawer",type:"checkbox",className:"drawer-toggle"}),(0,r.jsx)("div",{className:"drawer-content flex flex-col ",children:(0,r.jsxs)("main",{className:"flex-1 overflow-y-auto  ",ref:i,children:[t,(0,r.jsx)("div",{className:"h-16"})]})})]})})}},2926:function(e,t,a){"use strict";a.r(t),a.d(t,{AuthProvider:function(){return l},useAuth:function(){return i}});var r=a(7437),o=a(2265),n={saveToken:e=>{localStorage.setItem("token",e)},getToken:()=>JSON.stringify(localStorage.getItem("token")),logout:async()=>(localStorage.removeItem("token"),1),isAuthenticated:()=>!!localStorage.getItem("token")},s=a(7907),u=a(7908);let c=(0,o.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,o.useState)(!1),[i,h]=(0,o.useState)(null),[d,f]=(0,o.useState)(!0),g=(0,s.useRouter)(),k=(0,o.useCallback)(async()=>{let e=n.getToken();if(e)try{let t=await u.Z.get("".concat("http://127.0.0.1:5090","/api/user"),{headers:{Authorization:"Bearer ".concat(e)}});localStorage.setItem("userProfile",JSON.stringify(t.data)),h(t.data)}catch(e){console.error("Error fetching user profile:",e),await m()}},[]),m=(0,o.useCallback)(async()=>{let e=n.getToken();if(e)try{let{auth_token:t}=(await u.Z.post("".concat("http://127.0.0.1:5090","/api/auth/refresh"),{refresh_token:e})).data;await n.saveToken(t),await k()}catch(e){console.error("Error refreshing token:",e),y()}},[]),p=(0,o.useCallback)(()=>{l(n.isAuthenticated()),f(!1)},[]);(0,o.useEffect)(()=>{p()},[p]);let v=(0,o.useCallback)(async(e,t)=>{try{let a=await u.Z.post("".concat("http://127.0.0.1:5090","/api/auth/login"),{email:e,password:t}),{auth_token:r}=a.data.data;console.log("auth_token : ",r),n.saveToken(r),h(a.data.user),l(!0)}catch(e){throw console.error("Login error:",e),e}},[k]),w=(0,o.useCallback)(async(e,t,a)=>{try{let r=await u.Z.post("".concat("http://127.0.0.1:5090","/api/auth/register"),{email:e,username:a,password:t,name:""}),{auth_token:o}=r.data.data;n.saveToken(o),h(r.data.user),l(!0)}catch(e){throw console.error("Registration error:",e),e}},[k]),y=(0,o.useCallback)(async()=>{let e=localStorage.getItem("token");if(e)try{await u.Z.post("".concat("http://127.0.0.1:5090","/api/auth/logout"),{},{headers:{Authorization:"Bearer ".concat(e)}}),await n.logout(),h(null),l(!1),localStorage.removeItem("userProfile"),g.push("/login")}catch(e){console.error("Error during logout:",e)}},[g]);return(0,r.jsx)(c.Provider,{value:{isAuthenticated:a,isLoading:d,userProfile:i,login:v,logout:y,register:w},children:t})}function i(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[908,971,69,744],function(){return e(e.s=683)}),_N_E=e.O()}]);